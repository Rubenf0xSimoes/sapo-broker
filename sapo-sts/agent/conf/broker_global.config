<?xml version="1.0"?>

<global-config>
	<domain>
		<peer>
				<ip>127.0.0.1</ip>
				<port>3315</port>
		</peer>

		<!--<peer>
				<ip>127.0.0.1</ip>
				<port>3415</port>
		</peer>-->
	</domain>
	<!-- Message related configuration -->
	<messages>
		<max-msg-size>10240000</max-msg-size><!-- Maximum message size -->
		<prefer-local-consumers>true</prefer-local-consumers>
		<support-virtual-queues>true</support-virtual-queues>
		<queues>
			<max-queues>500</max-queues> <!-- Maximum number of queues -->
			<store-time>604800000</store-time> <!-- Maximum time a message is kept by the agent: 1 week (default) -->
			<max-stale-age>600000</max-stale-age> <!-- Maximum time a queue is allowed to exist without consumers: 2 weeks (default) -->
			<redelivery-interval>120000</redelivery-interval> <!-- time between redeliveries, default: 2 minutes) -->
		</queues>
		<topic>
			<max-distinct-subscriptions>500</max-distinct-subscriptions><!-- Maximum number of distinct subscriptions -->
		</topic>
	</messages>
	<security-policies>
		<policies>
			<policy policy-name="default">
				<acl>
					<entry action="DENY" destination-type="TOPIC QUEUE VIRTUAL_QUEUE" destination="/system/.*" privilege="WRITE">
						<condition condition-type="ALWAYS" />
					</entry>

					<entry action="DENY" destination-type="TOPIC QUEUE VIRTUAL_QUEUE" destination="/secret/.*" privilege="READ">
                        <condition condition-type="ALWAYS" />
                    </entry>

					<entry action="PERMIT" destination-type="TOPIC" destination="/secret/.*" privilege="READ">

						<condition condition-type="ROLE">
							<role>reidacocapreta@example.com</role>
						</condition>
					</entry>
				</acl>
			</policy>
		</policies>
	</security-policies>


    <authorization-providers>
        <authorization-provider provider-name="SapoSTS">

          <class>pt.com.broker.auth.saposts.SapoSTSProvider</class>

          <provider-params>
            <sts>
              <STSLocation>https://pre-release.services.bk.sapo.pt/STS/</STSLocation>
              <STSUsername>luis@luissantos.pt</STSUsername>
              <STSPassword>OTg#Yv9rfNivr8t$^TsCpgjcLJStY2vYF3G!*UF2699U8</STSPassword>
            </sts>
          </provider-params>

        </authorization-provider>

    </authorization-providers>


      <credential-validators>
        <credential-validator provider-name="SapoSTS">
          <class>pt.com.broker.auth.saposts.SapoSTSAuthInfoValidator</class>
          <provider-params>
              <sts>
                <sts-location>https://pre-release.services.bk.sapo.pt/STS/</sts-location>
                <sts-username>luis@luissantos.pt</sts-username>
                <sts-password>OTg#Yv9rfNivr8t$^TsCpgjcLJStY2vYF3G!*UF2699U8</sts-password>
              </sts>
            </provider-params>
        </credential-validator>
      </credential-validators>


</global-config>
